---
import Layout from "@/layouts/Layout.astro"
import { getCollection, render } from "astro:content"

export async function getStaticPaths() {
	const posts = await getCollection("posts")
	return posts.map(post => ({
		params: { slug: post.id },
		props: post,
	}))
}
const post = Astro.props
const { Content } = await render(post)
const tagsCollection = await getCollection("tags")
const tagTitleMap = Object.fromEntries(tagsCollection.map(tag => [tag.id, tag.data.title]))
---

<Layout {...post.data} type ogImage={post.data?.ogImage?.src}>
	<a
		href="/posts"
		class="a self-start"
		>–ù–∞–∑–∞–¥ –∫ —Å—Ç–∞—Ç—å—è–º</a
	>
	<div class="glass-card p-6 md:p-8">
		<h1 class="text-4xl lg:text-6xl mb-4 font-black">
			{post.data.title}
		</h1>
		<p class="text-slate-600">{post.data.description}</p>
	</div>
	<div class="glass-card p-4 items-center flex flex-wrap justify-between gap-3">
		<div class="flex gap-3 flex-wrap">
			{
				post.data.tags &&
					post.data.tags.map(tag => (
						<span class="rounded-full border border-blue-100 bg-blue-50 px-2.5 py-1 text-xs font-semibold text-blue-700">
							üè∑ {tagTitleMap[tag] || tag}
						</span>
					))
			}
		</div>
		{
			post.data.pubDate && (
				<time datetime={post.data.pubDate} class="text-slate-600">
					üóì –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
					<b>
						{new Date(post.data.pubDate).toLocaleDateString("ru-RU", {
							year: "numeric",
							month: "numeric",
							day: "numeric",
						})}
					</b>
				</time>
			)
		}
	</div>

	<main
		class="glass-card prose max-w-none prose-lg prose-a:text-blue-600 prose-a:underline prose-a:underline-offset-4 px-6 py-8 md:px-10 xl:prose-xl"
	>
		<Content />
	</main>
</Layout>
