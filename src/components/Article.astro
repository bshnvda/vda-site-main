---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

const { data, id, favorite } = Astro.props;
const tagsCollection = await getCollection("tags");
const tagTitleMap = Object.fromEntries(tagsCollection.map((tag) => [tag.id, tag.data.title]));
---

<a href={`/posts/${id}`} class="hover-top" aria-label={data.title}>
	<article class="glass-card relative -z-0 items-center sm:flex rounded-b-none overflow-hidden">
		{
			favorite ? (
				<div class="absolute top-3 right-3 bg-[#0a84ff] rounded-full px-3 py-1.5 text-white text-sm flex gap-1 items-center font-medium shadow-[0_12px_24px_rgba(10,132,255,0.35)]">
					<>
						<Icon name="mdi:cards-heart" />
						<span>Ğ’Ğ°Ğ¶Ğ½Ğ¾Ğµ</span>
					</>
				</div>
			) : (
				""
			)
		}

		{
			data?.ogImage ? (
				<Image
					src={data?.ogImage}
					title={data.title}
					aria-label={data.title}
					class="object-cover bg-center sm:max-w-[220px] h-[220px]"
					alt={`Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ÑÑ‚Ğ°: ${data.title}`}
					format={"webp"}
					quality={10}
				/>
			) : (
				<div class="bg-slate-200 max-w-[220px] h-[220px]" />
			)
		}

		<div class="flex gap-3 p-5 flex-col">
			<h3 class="text-xl line-clamp-2 font-semibold text-balance text-slate-900">{data.title}</h3>
			<p class="line-clamp-2 text-pretty text-sm text-slate-600">
				{data.description}
			</p>

			{
				data.pubDate && (
					<time datetime={data.pubDate} class="text-slate-500 text-sm">
						ğŸ—“
						{new Date(data.pubDate).toLocaleDateString("ru-RU", {
							year: "numeric",
							month: "numeric",
							day: "numeric",
						})}
					</time>
				)
			}
		</div>
	</article>
	<div class="glass-card rounded-t-none border-t-0 px-3 py-3 flex flex-wrap gap-2">
		{
			data.tags &&
				data.tags.map((tag) => (
					<span class="rounded-full border border-blue-100 bg-blue-50 px-2.5 py-1 text-xs font-semibold text-blue-700">
						ğŸ· {tagTitleMap[tag] || tag}
					</span>
				))
		}
	</div>
</a>
