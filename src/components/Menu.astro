---
import { links } from "@/data/links"
import { cn } from "@/utils/cn"
import { Icon } from "astro-icon/components"
---

<nav class="hidden md:flex gap-5 items-center">
	{
		links &&
			links.map(link => (
				<a
					href={link.href}
					title={link.label}
					target={link.target}
					class={cn(
						"rounded-full px-3.5 py-2 text-sm font-medium text-slate-700 flex items-center gap-1.5 transition-all hover:bg-blue-50 hover:text-blue-700",
						link.style,
					)}
				>
					<Icon name={link.icon} />
					<span>{link.label}</span>
				</a>
			))
	}
</nav>

<div class="md:hidden">
	<button
		title="Мобильное меню"
		id="mobile-menu-toggle"
		aria-controls="mobile-menu-panel"
		aria-expanded="false"
		class="text-white flex items-center gap-1 bg-[#0a84ff] px-4 py-2 rounded-full shadow-[0_12px_24px_rgba(10,132,255,0.33)]"
	>
		<Icon name="mdi:menu-swap" />
		<span class="font-medium" id="mobile-menu-label">Меню</span>
	</button>

	<div
		id="mobile-menu-panel"
		class="fixed left-0 right-0 top-[84px] z-[90] px-4 opacity-0 invisible pointer-events-none -translate-y-2 transition-all duration-200"
	>
		<nav class="glass-card mx-auto w-full max-w-md p-4 flex gap-3 flex-col items-stretch">
			{
				links &&
					links.map(link => (
						<a
							href={link.href}
							title={link.label}
							target={link.target}
							class={cn(
								"rounded-2xl border border-slate-200/70 bg-white/85 px-4 py-3 text-slate-800 text-lg flex items-center gap-2",
								link.style,
							)}
						>
							<Icon name={link.icon} />
							<span>{link.label}</span>
						</a>
					))
			}
		</nav>
	</div>
</div>

<script>
	const menuPanel = document.querySelector("#mobile-menu-panel")
	const menuBtn = document.querySelector("#mobile-menu-toggle")
	const menuLabel = document.querySelector("#mobile-menu-label")
	const body = document.body
	const menuLinks = document.querySelectorAll("#mobile-menu-panel a")
	const OPEN_CLASS = "is-open"

	const setOpenState = isOpen => {
		menuPanel?.classList.toggle(OPEN_CLASS, isOpen)
		menuBtn?.setAttribute("aria-expanded", String(isOpen))
		menuLabel && (menuLabel.textContent = isOpen ? "Закрыть" : "Меню")
		body.classList.toggle("overflow-hidden", isOpen)
	}

	menuBtn?.addEventListener("click", event => {
		event.stopPropagation()
		const isOpen = menuPanel?.classList.contains(OPEN_CLASS)
		setOpenState(!isOpen)
	})

	menuLinks.forEach(link => {
		link.addEventListener("click", () => setOpenState(false))
	})

	document.addEventListener("click", event => {
		const target = event.target
		if (!menuPanel?.contains(target) && !menuBtn?.contains(target)) {
			setOpenState(false)
		}
	})

	window.addEventListener("keydown", event => {
		if (event.key === "Escape") setOpenState(false)
	})

	window.addEventListener("resize", () => {
		if (window.innerWidth >= 768) setOpenState(false)
	})
</script>

<style>
	#mobile-menu-panel.is-open {
		opacity: 1;
		visibility: visible;
		pointer-events: auto;
		transform: translateY(0);
	}
</style>
